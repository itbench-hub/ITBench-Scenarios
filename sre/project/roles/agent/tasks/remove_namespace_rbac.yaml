---
- name: Delete RoleBinding
  kubernetes.core.k8s:
    api_version: rbac.authorization.k8s.io/v1
    delete_all: true
    kind: RoleBinding
    kubeconfig: "{{ agent_cluster.kubeconfig }}"
    label_selectors:
      - app.kubernetes.io/component = access-provider
      - app.kubernetes.io/part-of = it-bench
    state: absent
    wait: true

- name: Delete Role
  kubernetes.core.k8s:
    api_version: rbac.authorization.k8s.io/v1
    delete_all: true
    kind: Role
    kubeconfig: "{{ agent_cluster.kubeconfig }}"
    label_selectors:
      - app.kubernetes.io/component = access-provider
      - app.kubernetes.io/part-of = it-bench
    state: absent
    wait: true

- name: Delete service account
  kubernetes.core.k8s:
    kubeconfig: "{{ agent_cluster.kubeconfig }}"
    src: files/serviceaccount.yaml
    state: absent
    wait: true

- name: Delete namespace
  kubernetes.core.k8s:
    kubeconfig: "{{ agent_cluster.kubeconfig }}"
    src: files/namespace.yaml
    state: absent
    wait: true
