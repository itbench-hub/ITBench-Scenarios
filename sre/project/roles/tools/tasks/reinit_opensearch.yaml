---
- name: Create jobs to delete OpenSearch indexes
  kubernetes.core.k8s:
    kubeconfig: "{{ tools_cluster.kubeconfig }}"
    namespace: "{{ helm_release.namespace }}"
    state: present
    src: files/opensearch/index-jobs.yaml
  register: tools_opensearch_reinit_jobs

- name: Wait for jobs to complete
  kubernetes.core.k8s_info:
    api_version: batch/v1
    kind: Job
    kubeconfig: "{{ tools_cluster.kubeconfig }}"
    name: "{{ item.result.metadata.name }}"
    namespace: "{{ item.result.metadata.namespace }}"
    wait: true
    wait_condition:
      type: Complete
      status: "True"
  loop: "{{ tools_opensearch_reinit_jobs.result.results }}"
  loop_control:
    label: job/{{ item.result.metadata.name }}
