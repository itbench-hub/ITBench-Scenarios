---
- name: Upload status file to S3 bucket
  amazon.aws.s3_object:
    endpoint_url: "{{ status_storage.s3.endpoint }}"
    bucket: "{{ status_storage.s3.bucket }}"
    object: /{{ status_storage.s3.directory }}/{{ temp_file.name }}.json
    src: "{{ temp_file.path }}"
    mode: put
  when:
    - status_storage.s3 is defined

- name: Copy temporary file into local directory
  ansible.builtin.copy:
    dest: "{{ status_storage.local.directory }}/{{ temp_file.name }}.json"
    mode: "0644"
    src: "{{ temp_file.path }}"
  when:
    - status_storage.local is defined
