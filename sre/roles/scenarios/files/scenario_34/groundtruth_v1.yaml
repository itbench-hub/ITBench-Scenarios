---
apiVersion: itbench.io/v1
kind: GroundTruth
metadata:
  name: scenario-34
spec:
  alerts:
    - group_id: cart-service-1
      id: RequestLatency
      metadata:
        description: Latency in service cart in namespace otel-demo is above 1500ms
    - group_id: cart-service-1
      id: RequestErrorRate
      metadata:
        description: Request error rate in service cart in namespace otel-demo is above 0
    - group_id: checkout-service-1
      id: RequestErrorRate
      metadata:
        description: Request error rate in service checkout in namespace otel-demo is above 0
    - group_id: frontend-service-1
      id: RequestErrorRate
      metadata:
        description: Request error rate in service frontend in namespace otel-demo is above 0
    - group_id: frontend-proxy-service-1
      id: RequestErrorRate
      metadata:
        description: Request error rate in service frontend-proxy in namespace otel-demo is above 0
  aliases:
    - - valkey-service-1
      - valkey-pod-1
    - - cart-service-1
      - cart-pod-1
    - - checkout-service-1
      - checkout-pod-1
    - - frontend-service-1
      - frontend-pod-1
    - - frontend-proxy-service-1
      - frontend-proxy-pod-1
  fault:
    - category: Configuration
      condition: Password authentication enabled on valkey-cart service without updating cart service configuration
      entity:
        group_id: valkey-pod-1
        kind: Pod
        name: valkey-pod-1
      fault_mechanism: custom
  groups:
    - filter:
        - valkey-cart-.*
      id: valkey-pod-1
      kind: Pod
      namespace: otel-demo
      root_cause: true
    - filter:
        - valkey-cart\b
      id: valkey-service-1
      kind: Service
      namespace: otel-demo
    - filter:
        - cart\b
      id: cart-service-1
      kind: Service
      namespace: otel-demo
    - filter:
        - cart-.*
      id: cart-pod-1
      kind: Pod
      namespace: otel-demo
    - filter:
        - checkout\b
      id: checkout-service-1
      kind: Service
      namespace: otel-demo
    - filter:
        - checkout-.*
      id: checkout-pod-1
      kind: Pod
      namespace: otel-demo
    - filter:
        - frontend\b
      id: frontend-service-1
      kind: Service
      namespace: otel-demo
    - filter:
        - frontend-.*
      id: frontend-pod-1
      kind: Pod
      namespace: otel-demo
    - filter:
        - frontend-proxy\b
      id: frontend-proxy-service-1
      kind: Service
      namespace: otel-demo
    - filter:
        - frontend-proxy-.*
      id: frontend-proxy-pod-1
      kind: Pod
      namespace: otel-demo
  propagations:
    - condition: Cart service cannot authenticate to valkey-cart due to password mismatch
      effect: Cart service experiences high latency and errors when accessing cart data
      source: valkey-pod-1
      target: cart-service-1
    - condition: Checkout service receives errors when trying to retrieve cart information
      effect: Checkout service experiences errors during cart operations
      source: cart-service-1
      target: checkout-service-1
    - condition: Frontend receives errors from checkout service due to cart failures
      effect: Frontend service experiences errors during cart and checkout operations
      source: checkout-service-1
      target: frontend-service-1
    - condition: Frontend-proxy receives errors from frontend service due to cart/checkout failures
      effect: Frontend-proxy service experiences errors when proxying requests
      source: frontend-service-1
      target: frontend-proxy-service-1
  recommendedActions:
    - solution:
        actions:
          - Update cart service configuration with correct valkey-cart password
          - Restart cart service pods to apply new authentication settings
          - Verify cart service can successfully connect to valkey-cart
        id: fix_cart_authentication
