---
apiVersion: itbench.io/v1
kind: GroundTruth
metadata:
  name: scenario-30
spec:
  alerts:
    - group_id: frontend-service-1
      id: RequestErrorRate
      metadata:
        description: Frontend service experiencing connection failures to ad service
    - group_id: frontend-proxy-service-1
      id: RequestErrorRate
      metadata:
        description: Frontend proxy experiencing errors when serving pages that require ads
  aliases:
    - - ad-service-1
      - ad-pod-1
    - - frontend-proxy-service-1
      - frontend-proxy-pod-1
    - - frontend-proxy-service-1
      - frontend-proxy-pod-1
    - - frontend-service-1
      - frontend-pod-1
  fault:
    - category: Configuration
      condition: Ad service port misconfigured to 9999 instead of correct port 8080
      entity:
        group_id: ad-service-1
        kind: Service
        name: ad-service-1
      fault_mechanism: misconfigured-service-port
  groups:
    - filter:
        - ad\b
      id: ad-service-1
      kind: Service
      namespace: otel-demo
      root_cause: true
    - filter:
        - ad-.*
      id: ad-pod-1
      kind: Pod
      namespace: otel-demo
    - filter:
        - frontend\b
      id: frontend-service-1
      kind: Service
      namespace: otel-demo
    - filter:
        - frontend-.*
      id: frontend-pod-1
      kind: Pod
      namespace: otel-demo
    - filter:
        - frontend-proxy\b
      id: frontend-proxy-service-1
      kind: Service
      namespace: otel-demo
    - filter:
        - frontend-proxy-.*
      id: frontend-proxy-pod-1
      kind: Pod
      namespace: otel-demo
  propagations:
    - condition: Ad pod listening on port 8080 but service configured to route to port 9999
      effect: Service cannot route traffic to the pod, making ad service unavailable
      source: ad-pod-1
      target: ad-service-1
    - condition: Frontend service cannot connect to ad service due to port misconfiguration
      effect: Frontend service fails to retrieve ads and displays pages with missing ad content
      source: ad-service-1
      target: frontend-service-1
    - condition: Frontend service returns degraded responses with missing ads to frontend proxy
      effect: Users experience incomplete loads in the absence of ads
      source: frontend-service-1
      target: frontend-proxy-service-1
  recommendedActions:
    - solution:
        actions:
          - Update ad service configuration to use correct port 8080 instead of 9999
          - Restart ad service pods to apply configuration changes
        id: fix_service_port
