---
metadata:
  version: "v1"
fault:
  - entity:
      name: payment-anti-affinity
      group_id: payment-anti-affinity
      kind: Deployment
    condition: Strict pod anti-affinity requires pods on different nodes but insufficient nodes available
    category: Configuration
    fault_mechanism: pod-anti-affinity-rescheduling
alerts:
  - id: PendingPodsDetected
    group_id: payment-pod-1
    metadata:
      description: Payment pods stuck in Pending state due to unsatisfiable anti-affinity rules
  - id: NoRequestsDetected
    group_id: payment-service-1
    metadata:
      description: Payment service has reduced capacity due to pending pods
  - id: RequestErrorRate
    group_id: checkout-service-1
    metadata:
      description: Checkout service experiencing errors due to payment service degradation
groups:
  - id: payment-anti-affinity
    kind: Deployment
    filter:
      - payment\b
    namespace: otel-demo
    root_cause: true
  - id: payment-service-1
    kind: Service
    filter:
      - payment\b
    namespace: otel-demo
  - id: payment-pod-1
    kind: Pod
    filter:
      - payment-.*
    namespace: otel-demo
  - id: checkout-service-1
    kind: Service
    filter:
      - checkout\b
    namespace: otel-demo
  - id: checkout-pod-1
    kind: Pod
    filter:
      - checkout-.*
    namespace: otel-demo
aliases:
  - - payment-service-1
    - payment-pod-1
  - - checkout-service-1
    - checkout-pod-1
propagations:
  - source: payment-anti-affinity
    target: payment-pod-1
    condition: Anti-affinity rules require more nodes than available in cluster
    effect: Pods unable to schedule and stuck in Pending state
  - source: payment-pod-1
    target: payment-service-1
    condition: Reduced number of payment pods available to serve traffic
    effect: Payment service has insufficient capacity
  - source: payment-service-1
    target: checkout-service-1
    condition: Checkout service cannot reliably reach payment service
    effect: Checkout operations fail or timeout
recommended_actions:
  - solution:
      id: relax_anti_affinity
      actions:
        - Update anti-affinity rules from requiredDuringScheduling to preferredDuringScheduling
        - Or increase cluster node count to satisfy anti-affinity requirements
