- name: Get current replica count before scaling down
  kubernetes.core.k8s_info:
    api_version: apps/v1
    kind: "{{ spec.workload.kind }}"
    kubeconfig: "{{ faults_cluster.kubeconfig }}"
    name: "{{ spec.workload.name }}"
    namespace: "{{ spec.workload.namespace }}"
  register: workload_info
  when: spec.workload.kind in ['Deployment', 'ReplicaSet', 'StatefulSet']

- name: Original replica count
  ansible.builtin.set_fact:
    original_replicas: "{{ workload_info.resources[0].spec.replicas | default(1) }}"
  when: spec.workload.kind in ['Deployment', 'ReplicaSet', 'StatefulSet']