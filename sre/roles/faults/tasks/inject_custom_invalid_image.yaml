---
- name: Inject fault (invalid image)
  kubernetes.core.k8s_json_patch:
    api_version: apps/v1
    kind: "{{ spec.workload.kind }}"
    kubeconfig: "{{ faults_cluster.kubeconfig }}"
    name: "{{ spec.workload.name }}"
    namespace: "{{ spec.workload.namespace }}"
    patch:
      - op: replace
        path: /spec/template/spec/containers/0/image
        value: quay.io/it-bench/hello-bench-invalid:1.0.0

- name: Import workload restart task
  ansible.builtin.import_task:
    file: force_workload_restart.yaml
  when:
    - (spec.workload.restart_policy | default('force')) == 'force'
  vars:
    faults_workload: "{{ spec.workload }}"
