[
    {
        "arguments": {
            "json_schema": {
                "properties": {
                    "container": {
                        "properties": {
                            "name": {
                                "type": "string"
                            }
                        },
                        "required": [
                            "name"
                        ],
                        "type": "object"
                    },
                    "k8s_object": {
                        "properties": {
                            "api_version": {
                                "enum": [
                                    "apps/v1"
                                ],
                                "type": "string"
                            },
                            "kind": {
                                "enum": [
                                    "Deployment",
                                    "StatefulSet"
                                ],
                                "type": "string"
                            },
                            "metadata": {
                                "properties": {
                                    "name": {
                                        "type": "string"
                                    },
                                    "namespace": {
                                        "type": "string"
                                    }
                                },
                                "required": [
                                    "name",
                                    "namespace"
                                ],
                                "type": "object"
                            }
                        },
                        "required": [
                            "api_version",
                            "kind",
                            "metadata"
                        ],
                        "type": "object"
                    }
                },
                "required": [
                    "k8s_object",
                    "container"
                ],
                "type": "object"
            }
        },
        "description": "This fault injects an invalid command to a designated Kubernetes workload's container.",
        "expectation": "The faulted pod(s) will enter the `CrashLoopBackOff` state and container will enter the `Terminated` state. The workload will become unable to function.",
        "id": "invalid-kubernetes-workload-container-command",
        "name": "Invalid Kubernetes Workload Container Command",
        "platform": "Kubernetes",
        "resources": [
            "https://kubernetes.io/docs/concepts/containers/images/",
            "https://kubernetes.io/docs/concepts/workloads/",
            "https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/",
            "https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/"
        ],
        "solutions": {
            "templates": [
                {
                    "steps": [
                        {
                            "command": "`kubectl -n {{ args.k8_object.metadata.namespace }} rollout undo {{ args.k8_object.kind }}/{{ args.k8_object.metadata.name }}`",
                            "text": "Revert the last change done to the manifest."
                        }
                    ]
                },
                {
                    "steps": [
                        {
                            "command": "`kubectl -n {{ args.k8_object.metadata.namespace }} edit {{ args.k8_object.kind }} {{ args.k8_object.metadata.name }}`",
                            "text": "Manually edit the manifest and replace the invalid command with the correct value."
                        }
                    ]
                }
            ]
        },
        "tags": [
            "Deployment",
            "Performance"
        ]
    },
    {
        "arguments": {
            "json_schema": {
                "properties": {
                    "container": {
                        "properties": {
                            "name": {
                                "type": "string"
                            }
                        },
                        "required": [
                            "name"
                        ],
                        "type": "object"
                    },
                    "k8s_object": {
                        "properties": {
                            "api_version": {
                                "enum": [
                                    "apps/v1"
                                ],
                                "type": "string"
                            },
                            "kind": {
                                "enum": [
                                    "Deployment",
                                    "StatefulSet"
                                ],
                                "type": "string"
                            },
                            "metadata": {
                                "properties": {
                                    "name": {
                                        "type": "string"
                                    },
                                    "namespace": {
                                        "type": "string"
                                    }
                                },
                                "required": [
                                    "name",
                                    "namespace"
                                ],
                                "type": "object"
                            }
                        },
                        "required": [
                            "api_version",
                            "kind",
                            "metadata"
                        ],
                        "type": "object"
                    }
                },
                "required": [
                    "k8s_object",
                    "container"
                ],
                "type": "object"
            }
        },
        "description": "This fault injects an nonexsitent image to a designated Kubernetes workload's container.",
        "expectation": "The faulted pod(s) will enter the `Pending` state due to an `ImagePullBackOff` error. The workload will become unable to function.",
        "id": "nonexistent-kubernetes-workload-container-image",
        "name": "Nonexistent Kubernetes Workload Container Image",
        "platform": "Kubernetes",
        "resources": [
            "https://kubernetes.io/docs/concepts/containers/images/",
            "https://kubernetes.io/docs/concepts/workloads/",
            "https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/",
            "https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/"
        ],
        "solutions": {
            "templates": [
                {
                    "steps": [
                        {
                            "command": "`kubectl -n {{ args.k8_object.metadata.namespace }} rollout undo {{ args.k8_object.kind }}/{{ args.k8_object.metadata.name }}`",
                            "text": "Revert the last change done to the manifest."
                        }
                    ]
                },
                {
                    "steps": [
                        {
                            "command": "`kubectl -n {{ args.k8_object.metadata.namespace }} edit {{ args.k8_object.kind }} {{ args.k8_object.metadata.name }}`",
                            "text": "Manually edit the manifest and replace the invalid image with the correct value."
                        }
                    ]
                }
            ]
        },
        "tags": [
            "Deployment",
            "Performance"
        ]
    },
    {
        "arguments": {
            "json_schema": {
                "properties": {
                    "flag": {
                        "properties": {
                            "name": {
                                "type": "string"
                            },
                            "state": {
                                "type": "string"
                            }
                        },
                        "required": [
                            "name",
                            "state"
                        ],
                        "type": "object"
                    },
                    "k8s_object": {
                        "properties": {
                            "api_version": {
                                "enum": [
                                    "v1"
                                ],
                                "type": "string"
                            },
                            "kind": {
                                "enum": [
                                    "ConfigMap"
                                ],
                                "type": "string"
                            },
                            "metadata": {
                                "properties": {
                                    "name": {
                                        "enum": [
                                            "flagd-config"
                                        ],
                                        "type": "string"
                                    },
                                    "namespace": {
                                        "type": "string"
                                    }
                                },
                                "required": [
                                    "name",
                                    "namespace"
                                ],
                                "type": "object"
                            }
                        },
                        "required": [
                            "api_version",
                            "kind",
                            "metadata"
                        ],
                        "type": "object"
                    }
                },
                "required": [
                    "k8s_object",
                    "flag"
                ],
                "type": "object"
            }
        },
        "description": "This fault activates an inplemented fault in the OpenTelemetry Demo.",
        "expectation": "The effects of the faults are listed [here](https://opentelemetry.io/docs/demo/feature-flags/#implemented-feature-flags).",
        "id": "opentelemetry-demo-feature-flag",
        "name": "OpenTelemetry Demo Feature Flag",
        "platform": "Kubernetes",
        "resources": [
            "https://opentelemetry.io/docs/demo/",
            "https://opentelemetry.io/docs/demo/feature-flags/",
            "https://opentelemetry.io/docs/demo/services/"
        ],
        "solutions": {
            "templates": [
                {
                    "steps": [
                        {
                            "command": "`kubectl -n {{ args.k8_object.metadata.namespace }} edit configmap {{ args.k8_object.metadata.name }}",
                            "text": "Disable the feature flag by manually editing the contents of the ConfigMap"
                        },
                        {
                            "command": "`kubectl -n {{ args.k8_object.metadata.namespace }} rollout restart deployment`",
                            "text": "Restart all of the Deployment workloads."
                        }
                    ]
                }
            ]
        },
        "tags": [
            "Deployment",
            "Performance"
        ]
    }
]
