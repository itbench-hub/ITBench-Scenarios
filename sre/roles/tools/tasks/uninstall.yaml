---
- name: Import Kubernetes Topology Monitor uninstallation tasks
  ansible.builtin.import_tasks:
    file: uninstall_kubernetes_topology_monitor.yaml
  vars:
    helm_release: "{{ tools_helm_releases.kubernetes_topology_monitor }}"
  when:
    - tools_required.kubernetes_topology_monitor

- name: Import Kubernetes Metrics Server uninstallation tasks
  ansible.builtin.import_tasks:
    file: uninstall_kubernetes_metrics_server.yaml
  vars:
    helm_release: "{{ tools_helm_releases.kubernetes_metrics_server }}"
  when:
    - tools_required.kubernetes_metrics_server
    - tools_cluster.platform == "kubernetes"

- name: Import Istio uninstallation tasks
  ansible.builtin.import_tasks:
    file: uninstall_istio.yaml
  vars:
    helm_release: "{{ tools_helm_releases.istio.components }}"
  when:
    - tools_required.istio

- name: Import Chaos Mesh uninstallation tasks
  ansible.builtin.import_tasks:
    file: uninstall_chaos_mesh.yaml
  vars:
    helm_release: "{{ tools_helm_releases.chaos_mesh }}"
  when:
    - tools_required.chaos_mesh

- name: Import OpenCost uninstallation tasks
  ansible.builtin.import_tasks:
    file: uninstall_opencost.yaml
  vars:
    helm_release: "{{ tools_helm_releases.opencost }}"
  when:
    - tools_required.opencost

- name: Import OpenTelemetry uninstallation tasks
  ansible.builtin.import_tasks:
    file: uninstall_opentelemetry.yaml
  vars:
    helm_releases:
      collectors: "{{ tools_helm_releases.opentelemetry_collectors }}"
      operator: "{{ tools_helm_releases.opentelemetry_operator }}"
  when:
    - tools_required.jaeger or tools_required.opentelemetry

- name: Import Clickhouse installation tasks
  ansible.builtin.import_tasks:
    file: uninstall_clickhouse.yaml
  vars:
    helm_release: "{{ tools_helm_releases.clickhouse_operator }}"
    instance: "{{ tools_instances.clickhouse }}"
  when:
    - tools_required.clickhouse or tools_required.opentelemetry

- name: Import OpenSearch uninstallation tasks
  ansible.builtin.import_tasks:
    file: uninstall_opensearch.yaml
  vars:
    helm_release: "{{ tools_helm_releases.opensearch }}"
  when:
    - tools_required.opensearch or tools_required.jaeger

- name: Import Prometheus uninstallation tasks
  ansible.builtin.import_tasks:
    file: uninstall_prometheus.yaml
  vars:
    helm_release: "{{ tools_helm_releases.prometheus }}"
  when:
    - tools_required.prometheus or tools_required.opencost

- name: Import Ingress uninstallation tasks
  ansible.builtin.import_tasks:
    file: uninstall_ingress.yaml
  vars:
    helm_release: "{{ tools_helm_releases.ingress }}"
  when:
    - tools_required.ingress
