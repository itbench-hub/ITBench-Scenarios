---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: {{ route.name }}
  namespace: {{ route.namespace }}
spec:
  parentRefs:
    - name: {{ gateway.name }}
      namespace: "{{ tools_instances.kubernetes_gateways.namespace }}"
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: {{ route.path.prefix | default("/") }}
      filters:
        - type: ResponseHeaderModifier
          responseHeaderModifier:
            add:
              - name: Content-Security-Policy
                value: "img-src 'self' data:; connect-src 'self'; font-src 'self'; object-src 'none'; form-action 'none'; frame-ancestors 'none'"
              - name: Cross-Origin-Resource-Policy
                value: same-origin
              - name: Strict-Transport-Security
                value: max-age=31536000; includeSubDomains; preload
              - name: Referrer-Policy
                value: strict-origin-when-cross-origin
              - name: X-Content-Type-Options
                value: nosniff
              - name: X-Frame-Options
                value: DENY
              - name: X-XSS-Protection
                value: "0"
{% if route.path.enable_rewrites | default(false) %}
        - type: URLRewrite
          urlRewrite:
            path:
              type: ReplacePrefixMatch
              replacePrefixMatch: ""
{% endif %}
      backendRefs:
        - name: {{ route.service.name }}
          port: {{ route.service.port }}
