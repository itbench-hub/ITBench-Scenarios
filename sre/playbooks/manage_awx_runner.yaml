- name: Manage SRE and FinOps AWX Runner Stack
  hosts:
    - runner
  pre_tasks:
    - name: Import common role for Helm version check
      ansible.builtin.import_role:
        name: common
        tasks_from: check_helm_version
      tags:
        - always

    - name: Import common role for provider configuration
      ansible.builtin.import_role:
        name: common
        tasks_from: set_cluster_provider
      tags:
        - always
      vars:
        common_cluster:
          kubeconfig: "{{ stack.awx.kubeconfig }}"
  tasks:
    - name: Import awx role
      ansible.builtin.import_role:
        name: awx
      vars:
        awx_cluster:
          cloud_provider: "{{ cluster_provider }}"
          kubeconfig: "{{ stack.awx.kubeconfig }}"
        awx_credentials:
          aws: "{{ github.credentials.aws | default(omit) }}"
        awx_github:
          it_bench:
            ssh: "{{ github.it_bench.ssh | default(omit) }}"
            url: "{{ github.it_bench.url }}"
          llm_agent:
            ssh: "{{ github.llm_agent.ssh | default(omit) }}"
            url: "{{ github.llm_agent.url }}"
